async function init() {
  const recognizer = await createModel();
  const classLabels = recognizer.wordLabels();
  console.log("Class labels loaded:", classLabels);

  const labelContainer = document.getElementById("label-container");

  for (let i = 0; i < classLabels.length; i++) {
    labelContainer.appendChild(document.createElement("div"));
  }

  let lastCommandTime = 0;
  let directionLocked = false;

  recognizer.listen(result => {
    console.log("Speech result received:", result);
    const scores = result.scores;
    const currentTime = Date.now();

    // 冷卻時間縮短
    if (currentTime - lastCommandTime < 300 || directionLocked) {
      return;
    }

    let newDirection = null;

    // 提高識別閾值
    const threshold = 0.7;  // 只有當識別結果強烈時才執行

    // 更強的背景噪音過濾
    const noiseThreshold = 0.1;
    if (result.scores[4] > noiseThreshold) {
      console.log("Ignoring due to background noise");
      return;
    }

    // 增加識別邏輯
    for (let i = 0; i < classLabels.length; i++) {
      const classPrediction = classLabels[i] + ": " + result.scores[i].toFixed(2);
      labelContainer.childNodes[i].innerHTML = classPrediction;
      console.log(classPrediction);

      if (result.scores[i] > threshold) {
        if (classLabels[i] === "UP" && snake.dy === 0) {
          newDirection = { dx: 0, dy: -grid };
        } else if (classLabels[i] === "DOWN" && snake.dy === 0) {
          newDirection = { dx: 0, dy: grid };
        } else if (classLabels[i] === "LEFT" && snake.dx === 0) {
          newDirection = { dx: -grid, dy: 0 };
        } else if (classLabels[i] === "RIGHT" && snake.dx === 0) {
          newDirection = { dx: grid, dy: 0 };
        }
      }
    }

    if (newDirection) {
      snake.dx = newDirection.dx;
      snake.dy = newDirection.dy;
      directionLocked = true;
      lastCommandTime = currentTime;

      setTimeout(() => { directionLocked = false; }, 300);  // 冷卻時間縮短
    }
  }, {
    includeSpectrogram: true,
    probabilityThreshold: 0.7,  // 提高識別閾值
    invokeCallbackOnNoiseAndUnknown: true,
    overlapFactor: 0.50
  });
}
